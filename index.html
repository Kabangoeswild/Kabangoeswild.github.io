<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <title>AR.js Video on Hiro Marker</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">
    <a-scene embedded arjs='sourceType: webcam; trackingMethod: best;'>
        <a-assets>
            <!-- Preload the video and fallback image -->
            <video id="animatedVideo" src="fraction-residual-gas-ani.mp4" crossorigin="anonymous" preload="auto" loop style="display: none;"></video>
            <img id="fallbackImage" src="fallback-image.jpg" alt="Fallback Image">
        </a-assets>
        <a-marker preset="hiro">
            <!-- Display the video if available, otherwise display fallback image -->
            <a-video id="markerVideo" src="#animatedVideo" width="1" height="0.75" rotation="90 0 90" material="opacity: 0.8"></a-video>
            <a-image id="markerImage" width="1" height="0.75" rotation="90 0 90" visible="false" material="shader: flat"></a-image>
        </a-marker>
        <a-entity camera></a-entity>
        <!-- Error message if video source is not found -->
        <a-plane visible="false" position="0 1.5 -4" rotation="0 0 0" width="4" height="2" material="color: red; opacity: 0.8;" id="errorPlane">
            <a-text value="Video source not found" align="center" position="0 0 0.1" color="white"></a-text>
        </a-plane>
    </a-scene>
    <script>
        // JavaScript to handle the display of the video or fallback image
        var video = document.getElementById('animatedVideo');
        var markerVideo = document.getElementById('markerVideo');
        var markerImage = document.getElementById('markerImage');
        var errorPlane = document.getElementById('errorPlane');
        var fallbackImage = document.getElementById('fallbackImage').src;

        video.oncanplay = function() {
            markerVideo.setAttribute('visible', 'true');
            markerImage.setAttribute('visible', 'false');
        };

        video.onerror = function() {
            markerVideo.setAttribute('visible', 'false');
            markerImage.setAttribute('visible', 'true');
            markerImage.setAttribute('src', fallbackImage);
            errorPlane.setAttribute('visible', 'true');
        };

        // Fallback in case the video fails to load
        if (video.readyState === 0 || video.error) {
            markerVideo.setAttribute('visible', 'false');
            markerImage.setAttribute('visible', 'true');
            markerImage.setAttribute('src', fallbackImage);
            errorPlane.setAttribute('visible', 'true');
        }
    </script>
</body>
</html>
