<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <title>AR.js Video on Hiro Marker</title>
    <script src="aframe.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">
    <a-scene embedded arjs='sourceType: webcam; trackingMethod: best;' renderer="alpha: true">
        <a-assets>
            <video id="video1" src="xz_vlBL8XXz.mp4" crossorigin="anonymous" preload="auto" loop muted playsinline></video>
            <video id="video2" src="xz-rot-x-30-deg_qG4hQhwL.mp4" crossorigin="anonymous" preload="auto" loop muted playsinline></video>
            <video id="video3" src="swirl-center_URFn4HTn.mp4" crossorigin="anonymous" preload="auto" loop muted playsinline></video>
        </a-assets>
        <a-marker preset="hiro">
            <a-video id="markerVideo1" autoplay loop="true" src="#video1" width="1" height="0.75" position="0 0 0" rotation="-90 0 0" material="transparent: true; opacity: 0.8" visible="true"></a-video>
            <a-video id="markerVideo2" autoplay loop="true" src="#video2" width="1" height="0.75" position="0 0 0" rotation="-30 0 0" material="transparent: true; opacity: 0.8" visible="true"></a-video>
            <a-video id="markerVideo3" autoplay loop="true" src="#video3" width="1" height="0.75" position="0 0 0" rotation="0 90 0" material="transparent: true; opacity: 0.8" visible="true"></a-video>
        </a-marker>
        <a-entity camera></a-entity>
    </a-scene>

    <script>
        window.addEventListener('load', () => {
            const marker = document.querySelector('a-marker');
            const video1 = document.getElementById('video1');
            const video2 = document.getElementById('video2');
            const video3 = document.getElementById('video3');
            const markerVideo1 = document.getElementById('markerVideo1');
            const markerVideo2 = document.getElementById('markerVideo2');
            const markerVideo3 = document.getElementById('markerVideo3');

            function playVideo(video) {
                if (video.readyState >= 3) {
                    video.play();
                } else {
                    video.addEventListener('canplay', () => video.play(), { once: true });
                }
            }

            playVideo(video1);
            playVideo(video2);
            playVideo(video3);

            marker.addEventListener('markerFound', () => {
                const intervalId = setInterval(() => {
                    const markerRotation = marker.object3D.rotation;
                    const markerRotationY = markerRotation.y * THREE.MathUtils.RAD2DEG;
                    const markerRotationX = markerRotation.x * THREE.MathUtils.RAD2DEG;

                    console.log(`Marker Rotation X: ${markerRotationX.toFixed(2)}, Y: ${markerRotationY.toFixed(2)}`);

                    // Logic for video visibility based on marker rotation
                    if (markerRotationX > 70 && markerRotationY > -45 && markerRotationY < 45) {
                        console.log("Showing Video 1");
                        markerVideo1.setAttribute('visible', 'true');
                        markerVideo2.setAttribute('visible', 'false');
                        markerVideo3.setAttribute('visible', 'false');
                    } else if (markerRotationX <= 70 && markerRotationX > 45 && markerRotationY > -45 && markerRotationY < 45) {
                        console.log("Showing Video 2 and fade out Video 3");
                        markerVideo1.setAttribute('visible', 'true');
                        markerVideo2.setAttribute('visible', 'true');
                        markerVideo3.setAttribute('visible', 'false');
                    } else if (markerRotationX <= 45 && markerRotationY > -45 && markerRotationY < 45) {
                        console.log("Showing Video 2");
                        markerVideo1.setAttribute('visible', 'false');
                        markerVideo2.setAttribute('visible', 'true');
                        markerVideo3.setAttribute('visible', 'false');
                    } else if (markerRotationY >= 45 || markerRotationY <= -45) {
                        console.log("Showing Video 3");
                        markerVideo1.setAttribute('visible', 'false');
                        markerVideo2.setAttribute('visible', 'false');
                        markerVideo3.setAttribute('visible', 'true');
                    }

                    // Adjust opacity for each video based on the rotation
                    let opacity1 = 0.8 - Math.abs(markerRotationX - 90) / 90;
                    let opacity2 = 0.8 - Math.abs(markerRotationX - 30) / 60;
                    let opacity3 = 0.8 - Math.abs(markerRotationY - 45) / 45;

                    // Clamp the opacity values between 0 and 0.8
                    opacity1 = Math.max(0, Math.min(opacity1, 0.8));
                    opacity2 = Math.max(0, Math.min(opacity2, 0.8));
                    opacity3 = Math.max(0, Math.min(opacity3, 0.8));

                    // Apply opacity to videos
                    markerVideo1.setAttribute('material', 'opacity', opacity1);
                    markerVideo2.setAttribute('material', 'opacity', opacity2);
                    markerVideo3.setAttribute('material', 'opacity', opacity3);

                    // Log opacity for debugging
                    console.log(`Opacity - Video 1: ${opacity1}, Video 2: ${opacity2}, Video 3: ${opacity3}`);
                }, 100);

                marker.addEventListener('markerLost', () => {
                    clearInterval(intervalId);
                }, { once: true });
            });
        });
    </script>
</body>
</html>
